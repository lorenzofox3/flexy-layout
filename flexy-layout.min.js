!function(a){"use strict";a.module("flexyLayout.block",[]).provider("Block",function(){function b(b){if(this.blocks=[],a.isArray(b))for(var c=0,d=b.length;d>c;c++)b[c].moveLength&&b[c].canMoveLength&&b[c].getAvailableLength&&this.blocks.push(b[c])}function c(a){this.initialLength=a>0?a:0,this.isLocked=!1,this.lengthValue=0,this.minLength=0}function d(){this.lengthValue=5,this.initialPosition={x:0,y:0},this.availableLength={before:0,after:0},this.ghostPosition={x:0,y:0}}b.prototype.moveLength=function(a){for(var b,c=0,d=a,e=0,f=this.blocks.length;f>e;e++)this.blocks[e].canMoveLength(a)===!0&&c++;for(var g=0;c>0;g++)b=this.blocks[g].moveLength(a/c),a-=b,Math.abs(b)>0&&c--;return d-a},b.prototype.canMoveLength=function(a){for(var b=0,c=this.blocks.length;c>b;b++)if(this.blocks[b].canMoveLength(a)===!0)return!0;return!1},b.prototype.getAvailableLength=function(){for(var a=0,b=0,c=this.blocks.length;c>b;b++)a+=this.blocks[b].getAvailableLength();return a},b.prototype.clean=function(){delete this.blocks},c.prototype.moveLength=function(b){if(this.isLocked===!0)return 0;var c=this.lengthValue;return a.isNumber(b)&&(this.lengthValue=Math.max(0,this.lengthValue+b)),this.lengthValue-c},c.prototype.canMoveLength=function(a){return!(this.isLocked===!0||0>a&&0===this.getAvailableLength())},c.prototype.getAvailableLength=function(){return this.isLocked===!0?0:this.lengthValue-this.minLength},d.prototype.canMoveLength=function(){return!1},d.prototype.moveLength=function(){return 0},d.prototype.getAvailableLength=function(){return 0},this.$get=function(){return{getNewComposite:function(){var c=[].slice.call(arguments);return 1===c.length&&a.isArray(c[0])&&(c=c[0]),new b(c)},getNewBlock:function(a){return new c(a)},getNewSplitter:function(){return new d},isSplitter:function(a){return a instanceof d}}}})}(angular),function(a){"use strict";a.module("flexyLayout.directives",["flexyLayout.mediator"]).directive("flexyLayout",function(){return{restrict:"E",scope:{},template:'<div class="flexy-layout" ng-transclude></div>',replace:!0,transclude:!0,controller:"mediatorCtrl",link:function(a,b,c,d){var e=b[0][d.lengthProperties.offsetName];a.$watch(e,function(){d.init()})}}}).directive("blockContainer",["Block",function(a){return{restrict:"E",require:"^flexyLayout",transclude:!0,replace:!0,scope:{},template:'<div class="block"><div class="block-content" ng-transclude></div></div>',link:function(b,c,d,e){var f=b.$eval(d.init);b.block=a.getNewBlock(f),b.$watch("block.lengthValue",function(a){c.css(e.lengthProperties.lengthName,Math.floor(a)+"px")}),e.addBlock(b.block)}}}]).directive("blockSplitter",["Block",function(b){return{restrict:"E",require:"^flexyLayout",replace:!0,scope:{},template:'<div class="block splitter"><div class="ghost"></div></div>',link:function(c,d,e,f){c.splitter=b.getNewSplitter();var g=d.children()[0],h=function(a){this.initialPosition.x=a.clientX,this.initialPosition.y=a.clientY,this.availableLength=f.getSplitterRange(this),f.movingSplitter=this,a.preventDefault()};f.addBlock(c.splitter),d.bind("mousedown",a.bind(c.splitter,h)),c.$watch("splitter.ghostPosition."+f.lengthProperties.position,function(a,b){a!==b&&(g.style[f.lengthProperties.positionName]=a+"px")})}}}]),a.module("flexyLayout",["flexyLayout.directives"])}(angular),function(a){"use strict";a.module("flexyLayout.mediator",["flexyLayout.block"]).controller("mediatorCtrl",["$scope","$element","$attrs","Block",function(b,c,d,e){var f=[],g=null,h=0,i=this,j=["vertical","horizontal"],k=-1!==j.indexOf(d.orientation)?d.orientation:"horizontal",l="horizontal"===k?"flexy-layout-column":"flexy-layout-row";c.addClass(l),this.lengthProperties="horizontal"===k?{lengthName:"width",offsetName:"offsetWidth",positionName:"left",position:"x",eventProperty:"clientX"}:{lengthName:"height",offsetName:"offsetHeight",positionName:"top",position:"y",eventProperty:"clientY"},this.movingSplitter=null;var m=function(a){var b=0,c=this.lengthProperties.eventProperty,d=this.lengthProperties.position;null!==this.movingSplitter&&(b=a[c]-this.movingSplitter.initialPosition[d],this.movingSplitter.ghostPosition[d]=0>b?-1*Math.min(Math.abs(b),this.movingSplitter.availableLength.before):Math.min(b,this.movingSplitter.availableLength.after))},n=function(a){var b=0,c=this.lengthProperties.eventProperty,d=this.lengthProperties.position;null!==this.movingSplitter&&(b=a[c]-this.movingSplitter.initialPosition[d],this.moveSplitterLength(this.movingSplitter,b),this.movingSplitter.ghostPosition[d]=0,this.movingSplitter=null)};c.bind("mouseup",function(c){b.$apply(a.bind(i,n,c))}),c.bind("mousemove",function(c){b.$apply(a.bind(i,m,c))}),this.addBlock=function(a){e.isSplitter(a)?g=a:(null!==g&&(f.push(g),h++,g=null),f.push(a),this.init())},this.init=function(){var a,b,d=f.length,g=c[0][this.lengthProperties.offsetName],i=e.getNewBlock();for(f.push(i),a=0;d>a;a++)b=f[a],b.isLocked=!1,e.isSplitter(b)||b.moveLength(-1e4);for(i.moveLength(g-5*h),a=0;d>a;a++)b=f[a],b.initialLength>0&&(this.moveBlockLength(b,b.initialLength),b.isLocked=!0);for(this.moveBlockLength(i,-1e4),a=0;d>a;a++)f[a].isLocked=!1;f.splice(d,1)},this.moveBlockLength=function(a,b){var c,d,g,h,i="object"!=typeof a?a:f.indexOf(a);0>i||0===b||i>=f.length||(h=f[i],c=f.slice(0,i).concat(f.slice(i+1,f.length)),d=e.getNewComposite(c),d.canMoveLength(-b)===!0&&h.canMoveLength(b)===!0&&(0>b?(g=-1*h.moveLength(b),d.moveLength(g)):(g=-1*d.moveLength(-b),h.moveLength(g)),d.clean()))},this.moveSplitterLength=function(a,b){var c,d,g,h=f.indexOf(a);e.isSplitter(a)&&-1!==h&&(c=e.getNewComposite(o(a,!0)),d=e.getNewComposite(o(a,!1)),c.canMoveLength(b)&&d.canMoveLength(-b)&&(0>b?(g=-1*c.moveLength(b),d.moveLength(g)):(g=-1*d.moveLength(-b),c.moveLength(g)),d.clean(),c.clean()))},this.getSplitterRange=function(a){var b=o(a,!0),c=o(a,!1),d={before:b.getAvailableLength(),after:c.getAvailableLength()};return b.clean(),c.clean(),d},this.toggleLockBlock=function(a,b){var c,d="object"!=typeof a?a:f.indexOf(a);d>=0&&d<f.length&&(c=f[d],c.isLocked=b)};var o=function(a,b){for(var c,d=f.indexOf(a),g=b===!0?f.slice(0,d):f.slice(d+1,f.length),h=b===!0?Array.prototype.pop:Array.prototype.shift,i=[];(c=h.apply(g))&&!e.isSplitter(c);)i.push(c);return e.getNewComposite(i)}}])}(angular);